#!/usr/bin/env bash
# toggle the xdebug module in php.ini
PHP_INI=/etc/php/php.ini

# include some nice messaging functions
source functions.sh

if [[ $EUID -ne 0 ]]; then
    write_error "This script must be run as root"
    exit 1
fi

if [ $(grep -c '^zend_extension=/usr/lib/php/modules/xdebug.so' $PHP_INI) -gt 0 ]; then
    action_message "disable xdebug"
    sed -i "$PHP_INI" -e 's@^\(zend_extension=/usr/lib/php/modules/xdebug.so\)@;\1@'
else
    sed -i "$PHP_INI" -e 's@^;\(zend_extension=/usr/lib/php/modules/xdebug.so\)@\1@'
    action_message "enable xdebug"
fi

# restart the http service to make the changed to take effect
systemctl restart httpd.service
action_status $?
