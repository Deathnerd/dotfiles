#!/usr/bin/env bash
# extracts time data from stdin. 0.5d 2h 10m
dayhours=8

grep -oP '(\d*\.)?\d+[dhm]' |\
awk -v dayhours="$dayhours" '
    BEGIN{
        m = 0;
        mperhour = 60;
        mperday = dayhours * mperhour;
    }
    /m$/{
        m += $1;
    }
    /h$/{
        m += (mperhour * $1)
    }
    /d$/{
        m += (mperday * $1)
    }
    END{
        v = int(m/mperday);
        if (m/mperday >= 1) {
            printf "%dd ", v;
        }
        printf "%.2fh ", (m % mperday) / mperhour;
    }'
