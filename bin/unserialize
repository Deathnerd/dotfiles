#!/bin/env php
<?php
// call as unserialize[ TYPE]
//     TYPE  php, json
$type = isset($_SERVER['argv'][1]) ? $_SERVER['argv'][1] : null;
// do not concern about notices generated by unserialize
error_reporting(E_ALL & ~E_NOTICE);

// don't wait on stdin if input comes
stream_set_blocking(STDIN, 0);

for ($s = ''; ($tmp = fgets(STDIN, 8192)) !== false; $s .= $tmp);
if (!($s = trim($s))) {
    exit('No imput on sdtin');
}

switch ($type) {
    case 'json':
        var_export(($data = json_decode($s)) ? $data : $s);
        break;
    default:
        var_export(($data = unserialize($s)) ? $data : $s);
        break;
}
