#!/usr/bin/env bash
# toggle the xdebug module in php.ini
PHP_INI=/etc/php/7.0/apache2/conf.d/20-xdebug.ini

# include some nice messaging functions
source functions.sh

if [[ $EUID -ne 0 ]]; then
    write_error "This script must be run as root"
    exit 1
fi

if [ $(grep -c '^zend_extension=xdebug.so' $PHP_INI) -gt 0 ]; then
    action_message "disable xdebug"
    sed -i "$PHP_INI" -e 's@^\(zend_extension=xdebug.so\)@;\1@'
else
    sed -i "$PHP_INI" -e 's@^;\(zend_extension=xdebug.so\)@\1@'
    action_message "enable xdebug"
fi

# restart the http service to make the changed to take effect
systemctl restart apache2
action_status $?
